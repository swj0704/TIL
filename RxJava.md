# RxJava

## RxJava를 공부하게 된 계기
안드로이드를 공부한지 얼마 안되어서 안드로이드를 제대로 하려면 RxJava정도는 공부 해야한다는 학교 선배의 말을 듣고 RxJava를 공부해야겠다는 생각을 갖게 되었다. 그러나 안드로이드를 공부한지 얼마 지나지 않은 내 머리에 잘 들어오지 않았고 그렇게 안드로이드 기본들 위주로 공부를 하다가, 취업할 때 쯤이 되어 실력에 자신이 생겨 공부를 해보게 되었다.   
~~정말 공부했던것들 중에 처음에 이해하는 것이 가장 어려웠다~~

## RxJava란?
데이터의 흐름과 전달에 관한 프로그래밍 패러다임을 리액티브 프로그래밍이라 하는데, Java는 이가 구현되어있지 않았으나, Netflix ~~우리가 아는 그 넷플릭스 맞다!!~~ 에서 Java로 리액티브 프래그래밍을 구현하여 라이브러리화 한것이 RxJava이다.
### 리액티브 프래그래밍이란?
기존 Java에서는 변경된 사항이 있다면 직접 요청을 보내 데이터를 받아와야하지만, 리액티브 프로그래밍의 경우에는 데이터 변경이 발생하면 변경이 발생한 곳에서 데이터를 직접 보내준다. 쉽게 말해, 데이터 변경이 일어나면 알아서 변경된 데이터를 보내준다.

## 왜 RxJava를 사용해야하는가?
이전에 비동기 처리를 배우면서, 라이브러리의 callback도 비동기 라고 했던것을 본적이 있을것이다. 그러나 callback은 엄밀히 말하자면 비동기 처리에 효과적이지는 않다. 예를 들어보자
```kotlin
fun 회사가기(){
    val 잠든_사람 = 사람()
    일어나기(잠든_사람){ 잠깨서_졸린_사람 ->
        씻기(잠깨서_졸린_사람){ 씻은_사람 ->
            옷입기(씻은_사람){ 깔끔한_사람 ->
                출발(깔끔한_사람){ 출발한_사람 ->
                    출근(출발한_사람){ 출근한_사람 ->
                        일하기(출근한_사람)
                    }
                }
            }
        }
    }
}
```
대충 회사가는 과정을 callback으로 나타내어보았는데, 보기만 해도 벌써 진절머리가 날법한 코드이다.   
~~심지어 에러처리도 하지 않았다!! 에러처리까지 한다면...~~
이를 RxJava로 바꾸면 나름 효과적으로 할 수 있다.
```kotlin
fun 회사가기(){
    val 잠든_사람 = 사람()
    Observable
        .just(잠든_사람)
        .flatmap { 잠든_사람 -> 일어나기(잠든_사람) }
        .flatmap { 잠깨서_졸린_사람 -> 씻기(잠깨서_졸린_사람) }
        .flatmap { 씻은_사람 -> 옷입기(씻은_사람) }
        .flatmap { 깔끔한_사람 -> 출발(깔끔한_사람) }
        .flatmap { 출발한_사람 -> 출근(출발한_사람) }
        .subscribe({ 출근한_사람 ->
            알하기(출근한_사람)
        }, {
            에러처리()
        })
}
```
콜백 지옥에 비하면 아주 보기 편한 코드가 아닐수 없다.   
물론 Rx를 모르는 사람이 보기에는 어려운 코드일지 몰라도, Rx를 공부하게 된다면 너무나 좋은 방법이다.   
~~에러 처리도 되어있다!!~~

그렇다면 RxJava에 대해서 공부해보도록 하자

## 마블 다이어그램 보기
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FT2UdP%2FbtqEdxlePoL%2Ftc3nShCYhTFdGYh50SKKK1%2Fimg.png">
마블 다이어 그램을 보는 방법은, 위에 있는 빨간 원이 발행되는 데이터, 중간에 just나 flatMap 같은 함수가 오고, 그 결과가 아래에 나타나게 된다. 또, 위 사진 화살표 마지막 부분에 보면 '|' 이 모양의 기호가 있는데, 이 기호는 onComplete가 되었다는 뜻이다.

## RxJava 사용해보기
RxJava에는 사실 수많은 operation이 있고, 이를 일일히 외워 사용하거나 일일히 문서를 보고 사용해야 정확히 알고 사용할 수 있다. 하지만, 이것만 알면 나머지도 쉽게 사용할 수 있다.   
우선 위에 사용된것들부터 알아보자
### Observable
RxJava의 기본이 되는 클래스이다. RxJava에서는 Observable을 구독하는 Observer가 있고, Observable이 발행하는 데이터에 순차적으로 반응한다. Observable은 Emitter가 발생시키는 이벤트에 반응하며, 해당 이벤트들은 다음과 같다.

onNext() :  데이터를 발행하는 함수로,  데이터의 발행을 알린다.
onComplete() : 모든 데이터의 발행이 완료 되었음을 알리며, 딱 한번만 실행 되고, 실행 이후에는 onNext() 호출이 불가능하다
onError() : 데이터 발행 도중 에러가 발생 했음을 알린다. 이후에 어떤 이벤트도 발생하지 않는다.

#### subscribe
onNext에서 발행한 데이터를 가지고 할 행동을 정해주려면 subscribe를 해주어야 한다. subscribe 함수에는 각각의 알림에 대해 실행할 내용을 지정한다.   
위 코드만 봐도 subscribe에서 출근한 사람이라는 데이터가 발행이 되면 일하기를 실행하고, onError에서는 에러처리가 실행된다.   
좀 더 쉽게 설명하자면, Observable을 subscribe 함수를 통해 구독 하고, Observable이 데이터를 발행하면, 데이터를 가지고 무언가를 진행한다.   
~~우리가 유튜버를 '구독'하고 있고, 유튜버가 영상을 '발행'하면 우리는 그 발행한 영상을 보고 평가하고 댓글달고 좋아요 누르는 것이 '무언가'라고 생각하면 쉽다.~~

### just 함수
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FT2UdP%2FbtqEdxlePoL%2Ftc3nShCYhTFdGYh50SKKK1%2Fimg.png">

Observable에서 데이터를 발행하는 방법중 하나인 정적 메소드이다. 다만 just 함수만으로는 데이터를 발행하지 않고, subscribe 함수와 같이 사용해야 한다. just 함수는 최대 데이터를 10개 발행할 수 있다. 다만 타입은 모두 같아야한다.  
just 함수는 입력된 데이터를 그대로 발행한다.

### flatMap 함수
<style>img { background-color:white; }</style>
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F993DFF4C5DE2098D25">    

먼저 마블 다이어그램을 보자,   
데이터는 원형으로 들어가게 되는데, flatMap은 이를 변환하여 subscribe에서는 그 변환된 데이터를  발행 하는 함수이다. 즉, 원형을 마름모 두개로 변환하여 데이터를 발행한다.
그런데, RxJava는 비동기 처리의 일종이기 때문에, 마름모 하나는 나왔지만, 두번째가 나오지 않은 상태에서 새 데이터가 들어가게 된다면, 새 데이터의 첫번째 마름모가 나올수도 있다.

## RxJava의 장단점
사실 이 외에도 엄청 많은 함수와 엄청 많은 Observable을 상속받은 클래스들이 있다. 사실 안드로이드에서는 RxJava나 Room에 RxJava를 적용하는데, Single이라는 클래스가 있다. 경험상 Single만 잘 써도 RxJava나 Room을 적용하는데 아주 큰 어려움이 있진 않다. 물론 앱 전체에서 써야하는 경우라면 Subject나 다른 Observable을 써야하고, Observable은 이중 가장 기본이므로 알아두는것이 좋다.
### 장점 
- 콜백 지옥 해소   
위 코드 예시에 나와있듯이 저런 콜백 지옥이 펼쳐진다면 어떤 개발자들도 좋아하지 않을것 같다. 이를 쉽게 해소 해주는 것이 RxJava이다.
- 이벤트나 데이터 가공의 용이   
이게 가장 큰 장점인것 같다. Retrofit 코드로 예를 들면, 어떤 api에서 호출이 종료된 후 다른 api를 호출 해야할때 바로 flatMap이나 map같은 변환 함수로 이벤트를 새로 불러올수도 있고, subscribe에서도 새 api의 반환값으로 동작을 할 수 있어서 편한 것 같다.
- 비동기 처리의 에러처리가 쉽다.   
onError만 쓰면 된다!

### 단점
- 학습 곡선이 높다   
진짜 처음에는 하나도 이해가 되지 않아 2년 뒤에 배운거만 봐도...   
~~너가 못한거야~~
- 결국엔 비동기 처리를 하기 위한 발악이기 때문에 잘못 작성 한다면 RxJava를 사용하지 않은 것 만 못할수도 있다.